var HI_RES=!!((window.devicePixelRatio>1&&screen.width>1300||screen.width>2e3)&&hires),IMG_POSTFIX=HI_RES?"@2x":"",SOUND_URL="igneous/sounds/loop.mp3",TERRAIN_URL_BASE="igneous/images/planet/",PAGE_SCROLL_INTERVAL=!1,COOKIE_EXPIRATION_DATE=new Date(new Date().setTime(new Date().getTime()+31536e6)),VOLUME=0,VOLUME_INTERVAL=!1,VOLUME_MAX=1,VOLUME_SPEED=.01,PLAY_SOUND=1==getCookie("PLAY_SOUND"),WINDOW_FOCUS=!0,WINDOW_WIDTH=$(window).width(),WINDOW_HEIGHT=$(window).height(),LARGE_TILES=$(".largeTile article"),ARTICLES=$("article"),LAYERS=["sky","terrain5-horizon","terrain4","terrain3","terrain2","terrain1-closest"],LAYER_WIDTH=[3600,7e3,6e3,6e3,6e3,6e3],LAYER_HEIGHT=[1800,484,1280,1014,600,162],LAYER_DURATION=[0,36500,4e4,6e4,1e5,2e5],wheelX=wheelY=0,pageFit=0,pageLength=0,pageStages=[],pageStageIndex=-1,pageVisible=!1,tileMargin=0,tileWidth=0,lastScroll=0,hash=getHash(),fastStart=!0,pageStart=!0,lockNav=!1,INTRO_DURATION_LONG=800,INTRO_DURATION_SHORT=100,backgroundSound={},soundStarted=!1;function gtag(){dataLayer.push(arguments)}function setCookie(e,t){var a="expires="+COOKIE_EXPIRATION_DATE.toGMTString();document.cookie=e+"="+t+"; "+a}function getCookie(e){for(var t=e+"=",a=document.cookie.split(";"),n=0;n<a.length;n++){var o=a[n].trim();if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}function getHash(){var e=window.location.hash;return e.length<2?"":(window.location.hash="",e)}function setTooltip(){$.fn.qtip.zindex=21e3,$.fn.qtip.modal_zindex=21e3,$(".tooltip").each(function(e){$(this).qtip({content:{text:$.parseHTML($(this).attr("data-tooltip"))},position:{my:"top center",at:"bottom center",target:$(this),viewport:$(window),effect:function(e,t,a){$(this).animate(t,{duration:600,easing:"easeInOut",queue:!1})}},style:{classes:"qtip-bootstrap qtip-shadow",tip:{corner:!0}},show:{effect:function(e){$(this).fadeIn()}},hide:{effect:function(e){$(this).fadeOut()}}})})}function scrollPage(){$(window).scrollTop(0),$(window).scrollLeft(0)}function setParallax(){$("#planet").parallax({calibrateX:mobile,calibrateY:mobile,limitX:!!mobile&&250,limitY:!!mobile&&85,scalarX:mobile?20:15,scalarY:mobile?15:10,frictionX:mobile?.95:.15,frictionY:mobile?.95:.15}),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(){deviceTiltEvent([event.beta,event.gamma])},!0):window.DeviceMotionEvent?window.addEventListener("devicemotion",function(){deviceTiltEvent([2*event.acceleration.x,2*event.acceleration.y])},!0):window.addEventListener("MozOrientation",function(){deviceTiltEvent([50*orientation.x,50*orientation.y])},!0)}function deviceTiltEvent(e){}function resizeLayers(){WINDOW_WIDTH=$(window).width(),WINDOW_HEIGHT=$(window).height(),lockNav=!0;for(var e=1;e<LAYERS.length;e++){var t=$("#layer"+e+" .scaled"),a=t.height()*(LAYER_WIDTH[e]/LAYER_HEIGHT[e]),n="moveLayer"+e,o=WINDOW_WIDTH/WINDOW_HEIGHT;$.keyframe.define([{name:n,from:{transform:"translate3d(0,0,0)"},to:{transform:"translate3d("+-a+"px,0,0)"}}]),t.resetKeyframe(),t.css("transform","translate3d(0,0,0)"),t.width(a*Math.max(2,o+.5)),addTiles(e,a),t.playKeyframe({name:n,duration:LAYER_DURATION[e],timingFunction:"linear",delay:0,repeat:"infinite",complete:function(){}})}setTileSize(),positionNav(),positionFooter(),showFooter(),WINDOW_WIDTH>1024&&pageVisible?showBackButton():hideBackButton(),!isLandscape()&&pageVisible&&$("#prevButton, #nextButton").fadeOut("slow"),isLandscape()?$("nav").css("z-index",15e3):$("nav").css("z-index",13999),WINDOW_HEIGHT<480?LARGE_TILES.addClass("scroll"):LARGE_TILES.removeClass("scroll"),setTimeout(function(){setTimeout(function(){scrollPage()},500),moveToCurrentStage()},100)}function setTileSize(){var e=WINDOW_HEIGHT,t=WINDOW_WIDTH,a=$(".largeTile article");e<455&&t>550?a.css({height:e-60,width:Math.min(106400/(e-100),t),top:45}):e<400?a.css({height:e-30,top:15}):a.css({width:"",height:"",top:""}),t<310&&$(".largeTile article").css({width:t-30}),setTimeout(function(){positionTiles()},650)}function addTiles(e,t){var a=$("#layer"+e+" .scaled"),n=Math.floor(t/4),o=Math.ceil(a.width()/n);a.find("div").remove();for(var i=0;i<=o;i++){var s=(i+1)%4;0===s&&(s=4),$('<div class="tile" style="width:'+n+"px;left:"+i*n+'px;"><img src="'+TERRAIN_URL_BASE+"terrain-level-"+e+IMG_POSTFIX+"_0"+s+'.png"/></div').appendTo(a)}}function positionTiles(){var e=WINDOW_WIDTH,t=e<320?15:Math.min(30,Math.ceil(.08*e)),a=$("section.largeTile article").first().width();pageFit=bestFit(e,a,t),tileMargin=t,tileWidth=a,$("section.largeTile").each(function(a){var n=$(this).find("article"),o=n.length,i=$(n[0]).width(),s=0;s=e>i*o+t*(o+1)?(e-(i*o+t*(o-1)))/2:e<2*i?(e-i)/2:2*t,n.each(function(e){$(this).css("left",s),s+=i+t}),$(this).width(s+2*t)}),pageVisible&&setTimeout(function(){calculateStages(!0)},600)}function positionNav(){isLandscape()?$("nav").css("top","20px"):($("nav").css("top",WINDOW_HEIGHT/2-$("nav").height()/2+"px"),introVisible&&hideIntro())}function showName(){fastStart&&setTimeout(function(){showMenu(),setTimeout(function(){hash.length>1&&$(hash).length>0?(showPage(hash),$('nav a[href="'+hash+'"]').addClass("selected")):amazon&&(showPage("#Prototypes"),$('nav a[href="#Prototypes"]').addClass("selected"))},200)},300),nameIntro=$("#name").textillate({in:{effect:"flipInY",sync:!1,shuffle:!1,reverse:!1,autoStart:!0,loop:!1,callback:function(){introVisible=!0,showTitle()}},out:{effect:"fadeOutUp",sync:!1,shuffle:!0,reverse:!1,autoStart:!1,loop:!1}}),$("#name").css("opacity",1)}function showTitle(){titleIntro=$("#title").textillate({in:{effect:"flipInY",sync:!1,shuffle:!1,reverse:!1,autoStart:!0,loop:!1,callback:function(){introVisible=!0,pageStart&&!fastStart&&setTimeout(function(){showMenu()},isLandscape()?INTRO_DURATION_SHORT:INTRO_DURATION_LONG)}},out:{effect:"fadeOutDown",sync:!1,shuffle:!0,reverse:!1,autoStart:!1,loop:!1,callback:function(){introVisible=!1,$("#intro").fadeOut("fast")}}}),$("#title").css("opacity",1)}function showIntro(){try{$("#intro").fadeIn("fast"),nameIntro.textillate("in"),titleIntro.textillate("in")}catch(e){}}function hideIntro(){try{nameIntro.textillate("out"),titleIntro.textillate("out")}catch(e){$("#intro").fadeIn("fast")}}function blurForeground(){SHOW_VISUALS&&($("#layer1").addClass("layer1_blur"),$("#layer2").addClass("layer2_blur"))}function blurBackground(){SHOW_VISUALS&&($("#layer1").addClass("blur1"),$("#layer2, #intro").addClass("blur2"),$("#layer3, #layer4").addClass("blur3"),$("#layer5").addClass("blur4"),$("#sky").addClass("blur4")),$("#vignette").removeClass("fadeOut").addClass("fadeIn")}function unblurBackground(){$("#layer1").removeClass("blur1"),$("#layer2, #intro").removeClass("blur2"),$("#layer3, #layer4").removeClass("blur3"),$("#layer5").removeClass("blur4"),$("#sky").removeClass("blur4"),$("#vignette").addClass("fadeOut")}function isLandscape(){return WINDOW_WIDTH>550}function bestFit(e,t,a){for(var n=Math.floor(e/t),o=0,i=new Date().getTime();n>1&&!((now=new Date().getTime())-i>3e3);){if((o=t*n+a*(n+1)-e)<0)return n;n--}return 1}function calculateStages(e){e||(pageStageIndex=0);var t=$("section.selected").find("article"),a=t.first().width(),n=t.length,o=Math.ceil(n/pageFit);pageStages=[0];for(var i=0,s=1;s<o;s++)i=1==pageFit?cssToNum($(t[s]).css("left"))-cssToNum($(t[0]).css("left")):s==o-1?cssToNum($(t[n-1]).css("left"))-WINDOW_WIDTH+a+2*tileMargin:cssToNum($(t[s*pageFit]).css("left"))-2*tileMargin,pageStages.push(-i);generateDots(),setTimeout(function(){moveToCurrentStage(),positionDots()},300)}function movePage(e){var t=$("section.selected");t.css("-webkit-transform","translate3d("+e+"px, 0, 0)"),t.css("transform","translate3d("+e+"px, 0, 0)"),t.find("article.flipped").removeClass("flipped")}function showPage(e){var t=$(e),a=fastStart;lockNav=!0,pageStageIndex=0,hidePage(!0),setTimeout(function(){t.addClass("selected");var e=t.find("article");e.each(function(t){var n=t>pageFit+2?5*t:300*t;$(this).delay(n).fadeIn(0,function(){$(this).addClass("pop"),t==e.length-1&&setTimeout(function(){lockNav=!1,isLandscape()&&a&&setTimeout(function(){hideIntro()},2e3)},500)})}),pageVisible=!0,pageStart=fastStart=!1,t.fadeIn("slow"),t.removeClass("fadeOut"),calculateStages(!1),scrollPage()},pageVisible?2500:0),$("nav").addClass("showPage"),blurBackground(),showFooter(),isLandscape()&&!a&&hideIntro(),WINDOW_WIDTH>1024&&WINDOW_HEIGHT>600?showBackButton():hideBackButton()}function hidePage(e){var t=$("section.selected");movePage(0),t&&(t.removeClass("selected"),LARGE_TILES.removeClass("show"),LARGE_TILES.removeClass("flipped"),t.find("article").each(function(t){var a=t>pageFit+2?t:(e?100:300)*t;$(this).delay(a).fadeIn(0,function(){$(this).removeClass("pop")})}),t.addClass("fadeOut"),setTimeout(function(){t.fadeOut("fast"),t.removeClass("fadeOut")},1500),pageVisible=!1),e||($("nav").removeClass("showPage"),setTimeout(function(){$("nav a").removeClass("selected")},mobile?900:100),$("#pagination").fadeOut("slow"),isLandscape()&&hideFooter(),hideBackButton(),unblurBackground(),isLandscape()&&showIntro(),lockNav=!1),$("#prevButton, #nextButton").fadeOut("slow")}function cssToNum(e){return+e.replace(/[^-\d\.]/g,"")}function next(){!lockNav&&(++pageStageIndex>=pageStages.length&&(pageStageIndex=pageStages.length-1),moveToCurrentStage())}function previous(){!lockNav&&(--pageStageIndex<0&&(pageStageIndex=0),moveToCurrentStage())}function moveToCurrentStage(){if(movePage(pageStages[pageStageIndex]),moveDot(pageStageIndex),setTimeout(function(){lockNav=!1},500),pageVisible&&isLandscape())switch(!0){case 1===pageStages.length:$("#prevButton, #nextButton").fadeOut("slow");break;case 0===pageStageIndex:$("#prevButton").fadeOut("slow"),$("#nextButton").fadeIn("slow"),setNextImage();break;case pageStageIndex===pageStages.length-1:$("#prevButton").fadeIn("slow"),$("#nextButton").fadeOut("slow"),setPreviousImage();break;default:$("#prevButton, #nextButton").fadeIn("slow"),setPreviousImage(),setNextImage()}}function moveDot(e){var t=+$("#pagination ul li.current a").attr("data-index"),a=$('#pagination ul li a[data-index="'+e+'"]').parent();e!=t&&($("#pagination ul li").removeClass("current current-from-right"),e<t&&a.addClass("current-from-right"),setTimeout(function(){a.addClass("current")},25))}function positionDots(){var e=$("section.largeTile.selected article").first(),t=(e.position().top,e.height()),a=$("#pagination").height(),n=Math.min((WINDOW_HEIGHT-t)/4-a/2,WINDOW_HEIGHT-a);WINDOW_HEIGHT>600&&(n+=25),$("#pagination").css("bottom",n)}function generateDots(){var e=pageStages.length,t="";if(e>1){for(var a=' class="current"',n=0;n<e;n++)t+="<li"+a+'><a href="#" data-index="'+n+'">Page '+(n+1)+"</a></li>",a="";$("#pagination ul li").remove(),$(t).appendTo("#pagination ul"),$("#pagination").fadeIn("slow"),addDotEvents()}else $("#pagination").fadeOut("slow")}function addDotEvents(){$("#pagination a").click(function(e){return pageStageIndex=+$(this).attr("data-index"),moveToCurrentStage(),!1})}function setNextImage(){var e=$("section.selected article"),t=$("section.selected"),a=Math.min((pageStageIndex+2)*pageFit-1,e.length-1),n=$(e[a]).find(".main img").prop("src");$("#nextButton .thumbnail").slideUp(350,"easeInSine",function(){"Help"==t.prop("id")?$(this).css("background-image",$(e[a]).find(".mainPanel").css("background-image")):$(this).css("background-image","url("+n+")"),$(this).slideDown(500,"easeOutSine")})}function setPreviousImage(){var e=$("section.selected article"),t=$("section.selected"),a=Math.max((pageStageIndex-1)*pageFit,0),n=$(e[a]).find(".main img").prop("src");amazon&&a<2&&"Achievements"==t.prop("id")&&(n=$(e[1]).find(".main img").prop("src")),$("#prevButton .thumbnail").slideUp(350,"easeInSine",function(){"Help"==t.prop("id")?$(this).css("background-image",$(e[a]).find(".mainPanel").css("background-image")):$(this).css("background-image","url("+n+")"),$(this).slideDown(500,"easeOutSine")})}function showMenu(){$("nav a").each(function(e){$(this).delay(200*e).fadeIn(10,function(){isLandscape()?$(this).addClass("animated bounceInDown"):$(this).addClass("animated bounceInLeft")})}),!isLandscape()&&introVisible&&hideIntro(),showFooter(),$("#preference, #loading, #curtain, #splash").remove()}function checkPoint(){$("#preference").css("opacity",1),$("#message").addClass("animated bounceInDown"),setTimeout(function(){$("#messageText").addClass("animated bounceIn")},500),setTimeout(function(){$("#message").addClass("continue"),setTimeout(function(){$("#message .roundSlideButton").addClass("animated fadeIn")},500)},1500)}function proceed(){$("#message").removeClass("bounceInDown").addClass("fadeOutUp"),$("#toggle-audio").is(":checked")?(PLAY_SOUND=!0,setCookie("PLAY_SOUND",1)):(PLAY_SOUND=!1,setCookie("PLAY_SOUND",0)),$("#toggle-visual").is(":checked")?(SHOW_VISUALS=!0,setCookie("SHOW_VISUALS",1)):(SHOW_VISUALS=!1,setCookie("SHOW_VISUALS",0)),$("#toggle-gyro").is(":checked")?(USE_GYRO=!0,setCookie("USE_GYRO",1)):(USE_GYRO=!1,setCookie("USE_GYRO",0)),init()}function setDefaultPref(){PLAY_SOUND=!0,setCookie("PLAY_SOUND",1),SHOW_VISUALS=!0,setCookie("SHOW_VISUALS",1),USE_GYRO=!0,setCookie("USE_GYRO",1)}function init(){if(USE_GYRO&&mobile?DeviceOrientationEvent.requestPermission().then(()=>{setParallax()}):setParallax(),PLAY_SOUND&&startSound(),setTooltip(),$("#planet").css("opacity",1),$("#curtain, #loading").addClass("animated fadeOut"),SHOW_VISUALS)var e=LAYERS.length-1,t=setInterval(function(){e<1?($("#vignette").addClass("fadeOut"),setTimeout(showName,fastStart?100:1500),setTimeout(blurForeground,fastStart?500:2e3),clearInterval(t)):($("#layer"+e).removeClass("dim"),e--)},fastStart?100:1500);else $(".terrain").removeClass("dim"),$("#vignette").addClass("fadeOut"),setTimeout(showName,fastStart?100:3e3);lockNav=!1,$("footer").css("display","block")}function positionFooter(){var e=mobile&&!isLandscape()?20:10;WINDOW_HEIGHT>600&&(e=WINDOW_HEIGHT-$("#footer").height()),$("#footer").css("top",e)}function showFooter(){!isLandscape()&&WINDOW_HEIGHT>420||WINDOW_HEIGHT>600?($("#footerRocket").removeClass("bounceOut").addClass("bounceIn"),setTimeout(function(){$("#footerFirst").removeClass("bounceOut").addClass("bounceIn"),setTimeout(function(){$("#footerLast").removeClass("bounceOut").addClass("bounceIn")},400)},700)):hideFooter()}function hideFooter(){$("#footerFirst, #footerLast").removeClass("bounceIn").addClass("bounceOut"),setTimeout(function(){$("#footerRocket").removeClass("bounceIn").addClass("bounceOut")},500)}function showBackButton(){$("#backButton").css("display","block").removeClass("bounceOut").addClass("bounceIn")}function hideBackButton(){$("#backButton").removeClass("bounceIn").addClass("bounceOut")}function navButtonEvent(e){if(!lockNav){if(lockNav=!0,e.hasClass("selected"))hidePage(!1),setTimeout(function(){$("nav a").removeClass("selected")},300);else{setTimeout(function(){$("nav a").removeClass("selected"),e.addClass("selected")},300);var t=e.attr("href");"#Shiblee"===t?window.top.location.href="index.html":showPage(t)}}}function flipArticle(e){e.parents("article").toggleClass("flipped")}function setVolume(e,t){clearInterval(VOLUME_INTERVAL);var a=t>VOLUME?1:-1;VOLUME_INTERVAL=setInterval(function(){((VOLUME+=VOLUME_SPEED*a)>=t&&1===a||VOLUME<=t&&-1===a)&&(VOLUME=t,clearInterval(VOLUME_INTERVAL));try{e.volume(VOLUME)}catch(n){}},10)}function startSound(){try{backgroundSound.start("backgroundSound"),setVolume(backgroundSound,PLAY_SOUND?VOLUME_MAX:0)}catch(e){}$(window).focus(function(){WINDOW_FOCUS=!0}).blur(function(){WINDOW_FOCUS=!1});var t=WINDOW_FOCUS;setInterval(function(){WINDOW_FOCUS&&!t?PLAY_SOUND&&setVolume(backgroundSound,VOLUME_MAX):WINDOW_FOCUS||setVolume(backgroundSound,0),t=WINDOW_FOCUS},1e3),$(window).on("keydown",function(e){if(83===e.which||32===e.which||77===e.which||80===e.which){if(!soundStarted)try{(backgroundSound=new SeamlessLoop).addUri(SOUND_URL,76799,"backgroundSound"),backgroundSound.callback(startSound)}catch(t){}(PLAY_SOUND=!PLAY_SOUND)?(setVolume(backgroundSound,VOLUME_MAX),setCookie("PLAY_SOUND",1)):(setVolume(backgroundSound,0),setCookie("PLAY_SOUND",0))}}),soundStarted=!0}buttonSound={},checkpoint=mobile,SHOW_VISUALS=1==getCookie("SHOW_VISUALS"),USE_GYRO=1==getCookie("USE_GYRO"),nameIntro=titleIntro=introVisible=!1,window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-7NYMSDMMJT"),supported&&(mobile&&!crawler&&addToHomescreen({detectHomescreen:!0,skipFirstVisit:!0,startDelay:20,lifespan:10}),$(window).on("touchmove",function(e){e.preventDefault()}),$(window).scroll(function(e){e.preventDefault()}),$("section").swipe({swipeLeft:function(e,t,a,n,o){next()},swipeRight:function(e,t,a,n,o){previous()},threshold:Math.min(.1*WINDOW_WIDTH,50),fingers:"all"}),$(document).swipe({pinchOut:function(e,t,a,n,o,i){hidePage(!1)},fingers:2,pinchThreshold:Math.min(.05*WINDOW_WIDTH,30)}),$("section").mousewheel(function(e,t){return wheelX=e.deltaX,wheelY=e.deltaY,!1}),$("#prevButton").click(function(e){return previous(),!1}),$("#nextButton").click(function(e){return next(),!1}),PAGE_SCROLL_INTERVAL=setInterval(function(){var e=new Date().getTime();(0!=wheelX||0!=wheelY)&&e-lastScroll>1600&&(lastScroll=e,(Math.abs(wheelX)>Math.abs(wheelY)?wheelX:-wheelY)>0?next():previous()),wheelX=wheelY=0},50),resizeLayers(),$(window).resize(function(){setTimeout(resizeLayers,50)}),$("#name").fitText(mobile?2:1.5),$("#title").fitText(mobile?3.5:2.5),mobile?($("nav a").on("touchstart",function(e){return navButtonEvent($(this)),!1}),$(".infoButton, .infoButtonClose").on("touchstart",function(e){return flipArticle($(this)),!1})):($("nav a").click(function(e){return navButtonEvent($(this)),!1}),$(".infoButton, .infoButtonClose").click(function(e){return flipArticle($(this)),!1})),$("#closeButton, #footer").click(function(e){return pageVisible&&hidePage(!1),!1}),$("#message .next").click(function(e){return proceed(),!1}),$(document).keyup(function(e){switch(!0){case 27==e.keyCode&&pageVisible:hidePage(!1);break;case 37==e.keyCode||38==e.keyCode:previous();break;case 39==e.keyCode||40==e.keyCode:next()}}),$("nav a").mouseenter(function(e){!$(this).hasClass("selected")&&PLAY_SOUND&&($("#hover-sound")[0].volume=.15,$("#hover-sound")[0].load(),$("#hover-sound")[0].play())}),$(window).load(function(){checkpoint?checkPoint():(setDefaultPref(),init())}));





